<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>AR Occlusion demo</title>
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://unpkg.com/aframe-render-order-component@1.1.0/dist/aframe-render-order-component.min.js"></script>
    <script>THREEx.ArToolkitContext.baseURL = 'https://raw.githack.com/jeromeetienne/ar.js/master/three.js/'</script>
    <link rel="stylesheet" href="./index.css">
</head>

<body style='margin: 0; overflow: hidden;'>

    <div class="onoffswitch">
        <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" value="geomatics" tabindex="0" onchange="getBuilding(this)" >
        <label class="onoffswitch-label" for="myonoffswitch">
            <span class="onoffswitch-inner"></span>
            <span class="onoffswitch-switch"></span>
        </label>
    </div>

    <a-scene
        id="scene"
        vr-mode-ui="enabled: false"
		embedded 
        arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'>
        
        <a-camera gps-camera rotation-reader></a-camera>

        <!--<a-entity gltf-model="https://dylan1211-hub.github.io/AR-Occlusion-Test/3D_model/wall.gltf" rotation="0 0 0" scale="1 1 1" gps-entity-place="longitude: 120.219143; latitude: 22.999803;" 
        animation-mixer /> 小正包子22.998328422050523, 120.22767385061094-->  <!--總圖前草坪22.999803, 120.219143-->

        <!--<a-entity gltf-model="https://dylan1211-hub.github.io/AR-Occlusion-Test/3D_model/Kirby.gltf" rotation="0 0 0" scale="20 20 20" gps-entity-place="longitude: 120.22789847379012; latitude: 22.998810029888585;" 
        material="transparent: true; opacity: 0.5" animation-mixer/>  總圖 22.999046, 120.219783-->  <!--ㄚ頭麵店後面longitude: 120.22789847379012; latitude: 22.998810029888585-->

        <!--<a-sphere color="#d12335" radius="5" gps-entity-place="longitude: 120.22022; latitude: 23.00059;" 
        material="transparent: true; opacity: 0.99;  depthTest: true;" animation-mixer  id="s1" renderOrder="1"></a-sphere> ㄚ頭麵店後面longitude: 120.22789847379012; latitude: 22.998810029888585--> <!--總圖 120.219783,22.99965--> 

        <!--<a-box gps-entity-place="longitude: 120.22022; latitude: 23.00059;" color="#d12335" depth="8" height="8" width="8" material="transparent: true; depthTest: true;" animation-mixer renderOrder="1" ></a-box>

        <a-box color="#4ecef9" depth="8" height="8" width="8"  gps-entity-place="longitude:120.22019; latitude: 22.99912;" 
        material="transparent: true; opacity: 0.5; depthTest: true;"  animation-mixer renderOrder="2"></a-box> ㄚ頭麵店longitude: 120.22761791880879; latitude: 22.99856170145283--> <!--總圖前草坪 120.21967,22.99910-->

        <!--<a-box color="#4ecef9" depth="4" height="4" width="4"  gps-entity-place="longitude:120.21967; latitude: 22.99910;" 
        material="transparent: true; opacity: 0.5" animation-mixer></a-box> ㄚ頭麵店longitude: 120.22788708878386; latitude: 22.998587005140383--> <!--總圖前草坪 120.21967,22.99910-->

        <a-sphere color="#884edf" radius="3" gps-entity-place="longitude: 120.22789847379012; latitude: 22.998810029888585;" 
        material="transparent: true;" animation-mixer id="s1" renderOrder="2"></a-sphere> <!--ㄚ頭麵店後面longitude: 120.22789847379012; latitude: 22.998810029888585--> <!--總圖 120.219783,22.99965-->
        

        <!--<a-sphere color="#e2bc32" radius="2" gps-entity-place="longitude: 120.21928; latitude: 22.99896;" 
         animation-mixer render-order="layer1" id="s2"></a-box>
        <a-sphere color="#e2367b" radius="2" gps-entity-place="longitude: 120.21862; latitude: 22.99926;" 
         animation-mixer render-order="layer1" id="s3"></a-box>
        <a-sphere color="#3a5eee" radius="2" gps-entity-place="longitude: 120.21886; latitude: 22.99981;" 
         animation-mixer render-order="layer1" id="s4"></a-box>
        <a-sphere color="#884edf" radius="2" gps-entity-place="longitude: 120.21899; latitude: 23.00058;" 
         animation-mixer render-order="layer1" id="s5"></a-box> 
        <a-sphere color="#4ec7df" radius="2" gps-entity-place="longitude: 120.22076; latitude: 22.99916;" 
         animation-mixer render-order="layer1" id="s6"></a-box>
        <a-sphere color="#eb8b1e" radius="2" gps-entity-place="longitude: 120.22126; latitude: 22.99997;" 
         animation-mixer render-order="layer1" id="s7"></a-box> 
        <a-sphere color="#3bb922" radius="2" gps-entity-place="longitude: 120.21880; latitude: 22.99840;" 
         animation-mixer render-order="layer1" id="s8"></a-box>-->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    
	</a-scene>
    <script>
        /*let building=[
            {
                name: 'Geomatics',
                lat: 22.99910,
                lon: 120.21967,
            }
        ];*/
        var b;
        function getBuilding(building){
            if(building.checked===true){
                console.log(building.value+" checked")

                let scene =document.getElementById('scene');
                scene.removeChild(document.getElementById('s1'));
                //scene.removeChild(document.getElementById('s2'));
                //scene.removeChild(document.getElementById('s3'));
                //scene.removeChild(document.getElementById('s4'));
                //scene.removeChild(document.getElementById('s5'));
                //scene.removeChild(document.getElementById('s6'));
                //scene.removeChild(document.getElementById('s7'));
                //scene.removeChild(document.getElementById('s8'));
                console.log("remove s1")


                function renderBuilding(building){

                    //render sphere
                    console.log("re-render sphere");
                    let scene =document.getElementById('scene');

                    const latitude = 22.998810029888585;
					const longitude =120.22789847379012;
                    const sphere = document.createElement('a-entity');
                    sphere.setAttribute('geometry','primitive: sphere')
                    sphere.setAttribute('id', 's1');
                    sphere.setAttribute('gps-entity-place', `latitude: ${latitude}; longitude: ${longitude}`);
                    sphere.setAttribute('color', '#e2dd36');
                    sphere.setAttribute('radius', '3');
                    sphere.setAttribute('animation-mixer');
                    sphere.setAttribute('renderOrder','2');
                    sphere.setAttribute('material', 'transparent: true;  depthTest: true');
                    sphere.addEventListener('loaded', () => {
							window.dispatchEvent(new CustomEvent('gps-entity-place-loaded'));
							console.log("render sphere");
						});
                    scene.appendChild(sphere);

                    console.log("render building");
                    b=1;
                    const latitude1 =22.998587005140383;
					const longitude1 = 120.22788708878386;
                    const box = document.createElement('a-entity');
                    box.setAttribute('geometry','primitive: box')
                    box.setAttribute('id', 'new-box');
                    box.setAttribute('gps-entity-place', `latitude: ${latitude1}; longitude: ${longitude1}`);
                    box.setAttribute('color', '#4ecef9');
                    box.setAttribute('depth', '8');
                    box.setAttribute('height', '8');
                    box.setAttribute('width', '8');
                    box.setAttribute('material', 'transparent: true; opacity: 0.1;  depthTest: true');
                    box.setAttribute('animation-mixer');
                    sphere.setAttribute('renderOrder','1');
                    box.addEventListener('loaded', () => {
							window.dispatchEvent(new CustomEvent('gps-entity-place-loaded'));
							console.log("render box");
						});
                    scene.appendChild(box);
                }

                renderBuilding(building);
            }

            else{
                console.log(building.value+" unchecked")

                if(b=1){
                    let scene =document.getElementById('scene');
                    scene.removeChild(document.getElementById('new-box'));
                    b=0;
                    console.log("remove box")
                }
                else{
                    console.log("nothing happened")
                }
            }
        }
    </script>
</body>